import{j as t,r as m,Q as y}from"./app-OhvGvjOB.js";import{c as C,L as E}from"./AuthenticatedLayout-CIIpZ10k.js";import{c as N,S as n}from"./config-CRQlmYBd.js";import"./transition-BSqaxkIn.js";import"./dog-rvt4AGSg.js";import"./ArrowRightOnRectangleIcon-V4BJe9IO.js";const b=C(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"})),i=N.apiBaseUrl;function A(){const[h,u]=m.useState(!1),[l,p]=m.useState([]),f=async()=>{try{u(!0);const e={"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Authorization:""},r=localStorage.getItem("token");r&&(e.Authorization=`Bearer ${r}`);const o=await fetch(`${i}/cart`,{method:"GET",headers:e,credentials:"same-origin"});if(!o.ok){const a=await o.json();throw new Error((a==null?void 0:a.message)||"Error al obtener el carrito.")}const s=await o.json();p(s)}catch(e){n.fire({icon:"error",title:"Error al obtener los datos.",text:e.message,confirmButtonColor:"#646464ff"})}finally{u(!1)}};m.useEffect(()=>{f()},[]);const x=async e=>{try{if(!(await fetch(`${i}/cart/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Authorization:`Bearer ${localStorage.getItem("token")}`},credentials:"same-origin"})).ok)throw new Error("Error al eliminar el producto.");p(o=>o.filter(s=>s.id!==e)),n.fire({icon:"success",title:"Producto eliminado",timer:1e3,showConfirmButton:!1}),window.dispatchEvent(new Event("cartChanged"))}catch(r){n.fire({icon:"error",title:"Error",text:r.message,confirmButtonColor:"#646464ff"})}},g=(l||[]).reduce((e,r)=>{const o=Number(r.product.price);return e+(isNaN(o)?0:o)},0).toFixed(2),w=async()=>{try{const e=localStorage.getItem("token"),r=await fetch(`${i}/address`,{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Authorization:`Bearer ${localStorage.getItem("token")}`},credentials:"same-origin"});if(!r.ok)throw new Error("Error al obtener direcciones");const o=await r.json();if(!o.length)return n.fire("Sin direcciones","Agrega una dirección primero.","warning");const{value:s}=await n.fire({title:"Selecciona una dirección",input:"select",inputOptions:o.reduce((c,d)=>(c[d.id]=`${d.street}, ${d.city}`,c),{}),inputPlaceholder:"Selecciona una dirección",showCancelButton:!0,confirmButtonText:"Confirmar",cancelButtonText:"Cancelar",confirmButtonColor:"#000"});if(!s)return;const a=await fetch(`${i}/shipments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:e?`Bearer ${e}`:"","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({address_id:s})});if(!a.ok){const c=await a.json();throw new Error(c.message||"Error al crear el envío")}const j=await a.json();n.fire({icon:"success",title:"Envío creado",text:"Tu pedido fue procesado correctamente.",timer:1500,showConfirmButton:!1}),window.location.href=`/shipments/${j.id}`}catch(e){n.fire({icon:"error",title:"Error al finalizar compra",text:e.message,confirmButtonColor:"#646464ff"})}};return t.jsxs(E,{children:[t.jsx(y,{title:"Carrito"}),t.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-10",children:[t.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Tu Carrito"}),h?t.jsx("p",{className:"text-gray-500",children:"Cargando..."}):l.length===0?t.jsx("p",{className:"text-gray-600",children:"Tu carrito está vacío."}):t.jsxs("div",{className:"space-y-6",children:[l.map(e=>{const r=Number(e.product.price);return t.jsxs("div",{className:"flex items-center gap-4 bg-white p-4 rounded-lg shadow-sm",children:[t.jsx("img",{src:e.product.image_path,alt:e.product.name,className:"w-24 h-24 object-cover rounded-md"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:e.product.name}),t.jsxs("p",{className:"text-gray-600",children:["$",isNaN(r)?"0.00":r.toFixed(2)]})]}),t.jsx("button",{onClick:()=>x(e.id),className:"text-red-500 hover:text-red-700",children:t.jsx(b,{})})]},e.id)}),t.jsxs("div",{className:"flex justify-between items-center border-t pt-4",children:[t.jsx("p",{className:"text-xl font-semibold",children:"Total:"}),t.jsxs("p",{className:"text-xl font-bold text-gray-800",children:["$",g]})]}),t.jsx("button",{className:"w-full mt-4 bg-black text-white py-3 rounded-md hover:bg-gray-800 transition-colors",onClick:w,children:"Finalizar compra"})]})]})]})}export{A as default};
